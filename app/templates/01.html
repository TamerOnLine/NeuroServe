<!-- app/templates/plugins.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NeuroServe - Plugins Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    h1 { margin-top: 0; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 1rem; background: #fff; }
    textarea, input, select { width: 100%; padding: .6rem; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: .6rem 1rem; border-radius: 8px; border: none; background: #0d6efd; color: #fff; cursor: pointer; }
    pre { background: #111; color: #0f0; padding: .8rem; border-radius: 8px; white-space: pre-wrap; }
    .muted { color: #666; font-size: .9rem; }
  </style>
</head>
<body>
  <h1>Plugins Demo</h1>
  <p class="muted">Discover installed plugins and run tasks via <code>POST /inference</code>.</p>

  <div class="row">
    <div class="card">
      <h3>Available Plugins</h3>
      <button onclick="loadPlugins()">Reload</button>
      <ul id="plugins"></ul>
    </div>

    <div class="card">
      <h3>Run a Task</h3>
      <label>Provider</label>
      <input id="provider" placeholder="e.g., clip"/>
      <label>Task</label>
      <input id="task" placeholder="e.g., embed-text"/>
      <label>JSON Payload</label>
      <textarea id="payload" rows="8">{}</textarea>
      <button onclick="runTask()">Send</button>
    </div>
  </div>

  <h3>Response</h3>
  <pre id="out"></pre>

<script>
async function loadPlugins() {
  const res = await fetch('/plugins');
  const data = await res.json();
  const ul = document.getElementById('plugins');
  ul.innerHTML = '';
  (data.plugins || []).forEach(p => {
    const li = document.createElement('li');
    li.textContent = p;
    li.style.cursor = 'pointer';
    li.onclick = () => document.getElementById('provider').value = p;
    ul.appendChild(li);
  });
}

async function runTask() {
  const provider = document.getElementById('provider').value.trim();
  const task = document.getElementById('task').value.trim();
  let body = {};
  try { body = JSON.parse(document.getElementById('payload').value); }
  catch (e) { alert('Invalid JSON body'); return; }

  body.provider = provider || body.provider;
  body.task = task || body.task;

  const res = await fetch('/inference', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body)
  });
  const data = await res.json();
  document.getElementById('out').textContent = JSON.stringify(data, null, 2);
}

loadPlugins();
</script>
</body>
</html>
